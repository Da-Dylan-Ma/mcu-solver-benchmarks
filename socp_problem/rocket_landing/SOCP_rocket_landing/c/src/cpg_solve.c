
/*
Auto-generated by CVXPYgen on February 15, 2024 at 18:19:39.
Content: Function definitions.
*/

#include "cpg_solve.h"
#include "cpg_workspace.h"

static cpg_int i;
static cpg_int j;

// Update user-defined parameters
void cpg_update_param3(cpg_int idx, cpg_float val){
  cpg_params_vec[idx+0] = val;
  Canon_Outdated.c = 1;
}

void cpg_update_param2(cpg_int idx, cpg_float val){
  cpg_params_vec[idx+87] = val;
  Canon_Outdated.G = 1;
}

// Map user-defined to canonical parameters
void cpg_canonicalize_c(){
  for(i=0; i<97; i++){
    Canon_Params.c[i] = 0;
    for(j=canon_c_map.p[i]; j<canon_c_map.p[i+1]; j++){
      Canon_Params.c[i] += canon_c_map.x[j]*cpg_params_vec[canon_c_map.i[j]];
    }
  }
}

void cpg_canonicalize_G(){
  for(i=0; i<7670; i++){
    Canon_Params.G->x[i] = 0;
    for(j=canon_G_map.p[i]; j<canon_G_map.p[i+1]; j++){
      Canon_Params.G->x[i] += canon_G_map.x[j]*cpg_params_vec[canon_G_map.i[j]];
    }
  }
}

// Retrieve primal solution in terms of user-defined variables
void cpg_retrieve_prim(){
  CPG_Prim.var1[0] = ecos_workspace->x[1];
  CPG_Prim.var1[1] = ecos_workspace->x[2];
  CPG_Prim.var1[2] = ecos_workspace->x[3];
  CPG_Prim.var1[3] = ecos_workspace->x[4];
  CPG_Prim.var1[4] = ecos_workspace->x[5];
  CPG_Prim.var1[5] = ecos_workspace->x[6];
  CPG_Prim.var1[6] = ecos_workspace->x[7];
  CPG_Prim.var1[7] = ecos_workspace->x[8];
  CPG_Prim.var1[8] = ecos_workspace->x[9];
  CPG_Prim.var1[9] = ecos_workspace->x[10];
  CPG_Prim.var1[10] = ecos_workspace->x[11];
  CPG_Prim.var1[11] = ecos_workspace->x[12];
  CPG_Prim.var1[12] = ecos_workspace->x[13];
  CPG_Prim.var1[13] = ecos_workspace->x[14];
  CPG_Prim.var1[14] = ecos_workspace->x[15];
  CPG_Prim.var1[15] = ecos_workspace->x[16];
  CPG_Prim.var1[16] = ecos_workspace->x[17];
  CPG_Prim.var1[17] = ecos_workspace->x[18];
  CPG_Prim.var1[18] = ecos_workspace->x[19];
  CPG_Prim.var1[19] = ecos_workspace->x[20];
  CPG_Prim.var1[20] = ecos_workspace->x[21];
  CPG_Prim.var1[21] = ecos_workspace->x[22];
  CPG_Prim.var1[22] = ecos_workspace->x[23];
  CPG_Prim.var1[23] = ecos_workspace->x[24];
  CPG_Prim.var1[24] = ecos_workspace->x[25];
  CPG_Prim.var1[25] = ecos_workspace->x[26];
  CPG_Prim.var1[26] = ecos_workspace->x[27];
  CPG_Prim.var1[27] = ecos_workspace->x[28];
  CPG_Prim.var1[28] = ecos_workspace->x[29];
  CPG_Prim.var1[29] = ecos_workspace->x[30];
  CPG_Prim.var1[30] = ecos_workspace->x[31];
  CPG_Prim.var1[31] = ecos_workspace->x[32];
  CPG_Prim.var1[32] = ecos_workspace->x[33];
  CPG_Prim.var1[33] = ecos_workspace->x[34];
  CPG_Prim.var1[34] = ecos_workspace->x[35];
  CPG_Prim.var1[35] = ecos_workspace->x[36];
  CPG_Prim.var1[36] = ecos_workspace->x[37];
  CPG_Prim.var1[37] = ecos_workspace->x[38];
  CPG_Prim.var1[38] = ecos_workspace->x[39];
  CPG_Prim.var1[39] = ecos_workspace->x[40];
  CPG_Prim.var1[40] = ecos_workspace->x[41];
  CPG_Prim.var1[41] = ecos_workspace->x[42];
  CPG_Prim.var1[42] = ecos_workspace->x[43];
  CPG_Prim.var1[43] = ecos_workspace->x[44];
  CPG_Prim.var1[44] = ecos_workspace->x[45];
  CPG_Prim.var1[45] = ecos_workspace->x[46];
  CPG_Prim.var1[46] = ecos_workspace->x[47];
  CPG_Prim.var1[47] = ecos_workspace->x[48];
  CPG_Prim.var1[48] = ecos_workspace->x[49];
  CPG_Prim.var1[49] = ecos_workspace->x[50];
  CPG_Prim.var1[50] = ecos_workspace->x[51];
  CPG_Prim.var1[51] = ecos_workspace->x[52];
  CPG_Prim.var1[52] = ecos_workspace->x[53];
  CPG_Prim.var1[53] = ecos_workspace->x[54];
  CPG_Prim.var1[54] = ecos_workspace->x[55];
  CPG_Prim.var1[55] = ecos_workspace->x[56];
  CPG_Prim.var1[56] = ecos_workspace->x[57];
  CPG_Prim.var1[57] = ecos_workspace->x[58];
  CPG_Prim.var1[58] = ecos_workspace->x[59];
  CPG_Prim.var1[59] = ecos_workspace->x[60];
  CPG_Prim.var1[60] = ecos_workspace->x[61];
  CPG_Prim.var1[61] = ecos_workspace->x[62];
  CPG_Prim.var1[62] = ecos_workspace->x[63];
  CPG_Prim.var1[63] = ecos_workspace->x[64];
  CPG_Prim.var1[64] = ecos_workspace->x[65];
  CPG_Prim.var1[65] = ecos_workspace->x[66];
  CPG_Prim.var1[66] = ecos_workspace->x[67];
  CPG_Prim.var1[67] = ecos_workspace->x[68];
  CPG_Prim.var1[68] = ecos_workspace->x[69];
  CPG_Prim.var1[69] = ecos_workspace->x[70];
  CPG_Prim.var1[70] = ecos_workspace->x[71];
  CPG_Prim.var1[71] = ecos_workspace->x[72];
  CPG_Prim.var1[72] = ecos_workspace->x[73];
  CPG_Prim.var1[73] = ecos_workspace->x[74];
  CPG_Prim.var1[74] = ecos_workspace->x[75];
  CPG_Prim.var1[75] = ecos_workspace->x[76];
  CPG_Prim.var1[76] = ecos_workspace->x[77];
  CPG_Prim.var1[77] = ecos_workspace->x[78];
  CPG_Prim.var1[78] = ecos_workspace->x[79];
  CPG_Prim.var1[79] = ecos_workspace->x[80];
  CPG_Prim.var1[80] = ecos_workspace->x[81];
  CPG_Prim.var1[81] = ecos_workspace->x[82];
  CPG_Prim.var1[82] = ecos_workspace->x[83];
  CPG_Prim.var1[83] = ecos_workspace->x[84];
  CPG_Prim.var1[84] = ecos_workspace->x[85];
  CPG_Prim.var1[85] = ecos_workspace->x[86];
  CPG_Prim.var1[86] = ecos_workspace->x[87];
}

// Retrieve dual solution in terms of user-defined constraints
void cpg_retrieve_dual(){
  CPG_Dual.d0[0] = ecos_workspace->y[0];
  CPG_Dual.d0[1] = ecos_workspace->y[1];
  CPG_Dual.d0[2] = ecos_workspace->y[2];
  CPG_Dual.d0[3] = ecos_workspace->y[3];
  CPG_Dual.d0[4] = ecos_workspace->y[4];
  CPG_Dual.d0[5] = ecos_workspace->y[5];
  CPG_Dual.d1[0] = ecos_workspace->y[6];
  CPG_Dual.d1[1] = ecos_workspace->y[7];
  CPG_Dual.d1[2] = ecos_workspace->y[8];
  CPG_Dual.d1[3] = ecos_workspace->y[9];
  CPG_Dual.d1[4] = ecos_workspace->y[10];
  CPG_Dual.d1[5] = ecos_workspace->y[11];
  CPG_Dual.d2[0] = ecos_workspace->y[12];
  CPG_Dual.d2[1] = ecos_workspace->y[13];
  CPG_Dual.d2[2] = ecos_workspace->y[14];
  CPG_Dual.d2[3] = ecos_workspace->y[15];
  CPG_Dual.d2[4] = ecos_workspace->y[16];
  CPG_Dual.d2[5] = ecos_workspace->y[17];
  CPG_Dual.d3[0] = ecos_workspace->y[18];
  CPG_Dual.d3[1] = ecos_workspace->y[19];
  CPG_Dual.d3[2] = ecos_workspace->y[20];
  CPG_Dual.d3[3] = ecos_workspace->y[21];
  CPG_Dual.d3[4] = ecos_workspace->y[22];
  CPG_Dual.d3[5] = ecos_workspace->y[23];
  CPG_Dual.d4[0] = ecos_workspace->y[24];
  CPG_Dual.d4[1] = ecos_workspace->y[25];
  CPG_Dual.d4[2] = ecos_workspace->y[26];
  CPG_Dual.d4[3] = ecos_workspace->y[27];
  CPG_Dual.d4[4] = ecos_workspace->y[28];
  CPG_Dual.d4[5] = ecos_workspace->y[29];
  CPG_Dual.d5[0] = ecos_workspace->y[30];
  CPG_Dual.d5[1] = ecos_workspace->y[31];
  CPG_Dual.d5[2] = ecos_workspace->y[32];
  CPG_Dual.d5[3] = ecos_workspace->y[33];
  CPG_Dual.d5[4] = ecos_workspace->y[34];
  CPG_Dual.d5[5] = ecos_workspace->y[35];
  CPG_Dual.d6[0] = ecos_workspace->y[36];
  CPG_Dual.d6[1] = ecos_workspace->y[37];
  CPG_Dual.d6[2] = ecos_workspace->y[38];
  CPG_Dual.d6[3] = ecos_workspace->y[39];
  CPG_Dual.d6[4] = ecos_workspace->y[40];
  CPG_Dual.d6[5] = ecos_workspace->y[41];
  CPG_Dual.d7[0] = ecos_workspace->y[42];
  CPG_Dual.d7[1] = ecos_workspace->y[43];
  CPG_Dual.d7[2] = ecos_workspace->y[44];
  CPG_Dual.d7[3] = ecos_workspace->y[45];
  CPG_Dual.d7[4] = ecos_workspace->y[46];
  CPG_Dual.d7[5] = ecos_workspace->y[47];
  CPG_Dual.d8[0] = ecos_workspace->y[48];
  CPG_Dual.d8[1] = ecos_workspace->y[49];
  CPG_Dual.d8[2] = ecos_workspace->y[50];
  CPG_Dual.d8[3] = ecos_workspace->y[51];
  CPG_Dual.d8[4] = ecos_workspace->y[52];
  CPG_Dual.d8[5] = ecos_workspace->y[53];
  CPG_Dual.d9 = ecos_workspace->z[0];
  CPG_Dual.d10 = ecos_workspace->z[1];
  CPG_Dual.d11 = ecos_workspace->z[2];
  CPG_Dual.d12 = ecos_workspace->z[3];
  CPG_Dual.d13 = ecos_workspace->z[4];
  CPG_Dual.d14 = ecos_workspace->z[5];
  CPG_Dual.d15 = ecos_workspace->z[6];
  CPG_Dual.d16 = ecos_workspace->z[7];
  CPG_Dual.d17 = ecos_workspace->z[8];
  CPG_Dual.d18[0] = ecos_workspace->z[9];
  CPG_Dual.d18[1] = ecos_workspace->z[10];
  CPG_Dual.d18[2] = ecos_workspace->z[11];
  CPG_Dual.d19[0] = ecos_workspace->z[12];
  CPG_Dual.d19[1] = ecos_workspace->z[13];
  CPG_Dual.d19[2] = ecos_workspace->z[14];
  CPG_Dual.d20[0] = ecos_workspace->z[15];
  CPG_Dual.d20[1] = ecos_workspace->z[16];
  CPG_Dual.d20[2] = ecos_workspace->z[17];
  CPG_Dual.d21[0] = ecos_workspace->z[18];
  CPG_Dual.d21[1] = ecos_workspace->z[19];
  CPG_Dual.d21[2] = ecos_workspace->z[20];
  CPG_Dual.d22[0] = ecos_workspace->z[21];
  CPG_Dual.d22[1] = ecos_workspace->z[22];
  CPG_Dual.d22[2] = ecos_workspace->z[23];
  CPG_Dual.d23[0] = ecos_workspace->z[24];
  CPG_Dual.d23[1] = ecos_workspace->z[25];
  CPG_Dual.d23[2] = ecos_workspace->z[26];
  CPG_Dual.d24[0] = ecos_workspace->z[27];
  CPG_Dual.d24[1] = ecos_workspace->z[28];
  CPG_Dual.d24[2] = ecos_workspace->z[29];
  CPG_Dual.d25[0] = ecos_workspace->z[30];
  CPG_Dual.d25[1] = ecos_workspace->z[31];
  CPG_Dual.d25[2] = ecos_workspace->z[32];
  CPG_Dual.d26[0] = ecos_workspace->z[33];
  CPG_Dual.d26[1] = ecos_workspace->z[34];
  CPG_Dual.d26[2] = ecos_workspace->z[35];
  CPG_Dual.d27[0] = ecos_workspace->z[36];
  CPG_Dual.d27[1] = ecos_workspace->z[37];
  CPG_Dual.d27[2] = ecos_workspace->z[38];
  CPG_Dual.d28[0] = ecos_workspace->z[39];
  CPG_Dual.d28[1] = ecos_workspace->z[40];
  CPG_Dual.d28[2] = ecos_workspace->z[41];
  CPG_Dual.d29[0] = ecos_workspace->z[42];
  CPG_Dual.d29[1] = ecos_workspace->z[43];
  CPG_Dual.d29[2] = ecos_workspace->z[44];
  CPG_Dual.d30[0] = ecos_workspace->z[45];
  CPG_Dual.d30[1] = ecos_workspace->z[46];
  CPG_Dual.d30[2] = ecos_workspace->z[47];
  CPG_Dual.d31[0] = ecos_workspace->z[48];
  CPG_Dual.d31[1] = ecos_workspace->z[49];
  CPG_Dual.d31[2] = ecos_workspace->z[50];
  CPG_Dual.d32[0] = ecos_workspace->z[51];
  CPG_Dual.d32[1] = ecos_workspace->z[52];
  CPG_Dual.d32[2] = ecos_workspace->z[53];
  CPG_Dual.d33[0] = ecos_workspace->z[54];
  CPG_Dual.d33[1] = ecos_workspace->z[55];
  CPG_Dual.d33[2] = ecos_workspace->z[56];
  CPG_Dual.d34[0] = ecos_workspace->z[57];
  CPG_Dual.d34[1] = ecos_workspace->z[58];
  CPG_Dual.d34[2] = ecos_workspace->z[59];
  CPG_Dual.d35[0] = ecos_workspace->z[60];
  CPG_Dual.d35[1] = ecos_workspace->z[61];
  CPG_Dual.d35[2] = ecos_workspace->z[62];
}

// Retrieve solver info
void cpg_retrieve_info(){
  CPG_Info.obj_val = (ecos_workspace->info->pcost);
  CPG_Info.iter = ecos_workspace->info->iter;
  CPG_Info.status = ecos_flag;
  CPG_Info.pri_res = ecos_workspace->info->pres;
  CPG_Info.dua_res = ecos_workspace->info->dres;
}

// Solve via canonicalization, canonical solve, retrieval
void cpg_solve(){
  // Canonicalize if necessary
  if (Canon_Outdated.c) {
    cpg_canonicalize_c();
  }
  for (i=0; i<97; i++){
    Canon_Params_conditioning.c[i] = Canon_Params.c[i];
  }
  if (Canon_Outdated.G) {
    cpg_canonicalize_G();
  }
  for (i=0; i<7670; i++){
    Canon_Params_conditioning.G->x[i] = Canon_Params.G->x[i];
  }
  if (!ecos_workspace  ) {
    ecos_workspace = ECOS_setup(97, 179, 54, 63, 10, (int *) &ecos_q, 0, Canon_Params_conditioning.G->x, Canon_Params_conditioning.G->p, Canon_Params_conditioning.G->i, Canon_Params_conditioning.A->x, Canon_Params_conditioning.A->p, Canon_Params_conditioning.A->i, Canon_Params_conditioning.c, Canon_Params_conditioning.h, Canon_Params_conditioning.b);
  } else {
    if ( Canon_Outdated.A||Canon_Outdated.b||Canon_Outdated.G) {
      ECOS_updateData(ecos_workspace, Canon_Params_conditioning.G->x, Canon_Params_conditioning.A->x, Canon_Params_conditioning.c, Canon_Params_conditioning.h, Canon_Params_conditioning.b);
    } else {
      if ( Canon_Outdated.c) {
        for (i=0; i<97; i++) { ecos_updateDataEntry_c(ecos_workspace, i, Canon_Params_conditioning.c[i]); };
      }
    }
  }
  ecos_workspace->stgs->feastol = Canon_Settings.feastol;
  ecos_workspace->stgs->abstol = Canon_Settings.abstol;
  ecos_workspace->stgs->reltol = Canon_Settings.reltol;
  ecos_workspace->stgs->feastol_inacc = Canon_Settings.feastol_inacc;
  ecos_workspace->stgs->abstol_inacc = Canon_Settings.abstol_inacc;
  ecos_workspace->stgs->reltol_inacc = Canon_Settings.reltol_inacc;
  ecos_workspace->stgs->maxit = Canon_Settings.maxit;
  // Solve with ECOS
  ecos_flag = ECOS_solve(ecos_workspace);
  // Retrieve results
  cpg_retrieve_prim();
  cpg_retrieve_dual();
  cpg_retrieve_info();
  // Reset flags for outdated canonical parameters
  Canon_Outdated.c = 0;
  Canon_Outdated.G = 0;
}

// Update solver settings
void cpg_set_solver_default_settings(){
  Canon_Settings.feastol = 1e-8;
  Canon_Settings.abstol = 1e-8;
  Canon_Settings.reltol = 1e-8;
  Canon_Settings.feastol_inacc = 1e-4;
  Canon_Settings.abstol_inacc = 5e-5;
  Canon_Settings.reltol_inacc = 5e-5;
  Canon_Settings.maxit = 100;
}

void cpg_set_solver_feastol(cpg_float feastol_new){
  Canon_Settings.feastol = feastol_new;
}

void cpg_set_solver_abstol(cpg_float abstol_new){
  Canon_Settings.abstol = abstol_new;
}

void cpg_set_solver_reltol(cpg_float reltol_new){
  Canon_Settings.reltol = reltol_new;
}

void cpg_set_solver_feastol_inacc(cpg_float feastol_inacc_new){
  Canon_Settings.feastol_inacc = feastol_inacc_new;
}

void cpg_set_solver_abstol_inacc(cpg_float abstol_inacc_new){
  Canon_Settings.abstol_inacc = abstol_inacc_new;
}

void cpg_set_solver_reltol_inacc(cpg_float reltol_inacc_new){
  Canon_Settings.reltol_inacc = reltol_inacc_new;
}

void cpg_set_solver_maxit(cpg_int maxit_new){
  Canon_Settings.maxit = maxit_new;
}
